name: Compile LaTeX Documents

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-public:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up TeX Live
      uses: xu-cheng/latex-action@v3
      with:
        root_file: |
          resume.tex
          cv.tex
        
    - name: Create public info file
      run: |
        cat > personal_info.tex << EOL
        % Public version of personal information
        \newcommand{\personalName}{Sean O'Connor}
        \newcommand{\personalEmail}{Contact for details}
        \newcommand{\personalPhone}{}
        \newcommand{\personalWebsite}{soconnor.dev}
        \newcommand{\personalSchoolEmail}{}
        \newcommand{\personalHomeAddress}{}
        \newcommand{\personalSchoolAddress}{}
        EOL
        
    - name: Upload Public PDFs as Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          resume.pdf
          cv.pdf
        name: Latest PDFs
        tag_name: latest
        body: |
          Latest version of resume and CV (public version)
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-private:
    runs-on: ubuntu-latest
    if: github.actor == github.repository_owner
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up TeX Live
      uses: xu-cheng/latex-action@v3
      with:
        root_file: |
          resume.tex
          cv.tex
          
    - name: Create private info file
      env:
        PERSONAL_EMAIL: ${{ secrets.PERSONAL_EMAIL }}
        PERSONAL_PHONE: ${{ secrets.PERSONAL_PHONE }}
        PERSONAL_SCHOOL_EMAIL: ${{ secrets.PERSONAL_SCHOOL_EMAIL }}
        PERSONAL_HOME_ADDRESS: ${{ secrets.PERSONAL_HOME_ADDRESS }}
        PERSONAL_SCHOOL_ADDRESS: ${{ secrets.PERSONAL_SCHOOL_ADDRESS }}
      run: |
        cat > personal_info.tex << EOL
        % Private version of personal information
        \newcommand{\personalName}{Sean O'Connor}
        \newcommand{\personalEmail}{${PERSONAL_EMAIL}}
        \newcommand{\personalPhone}{${PERSONAL_PHONE}}
        \newcommand{\personalWebsite}{soconnor.dev}
        \newcommand{\personalSchoolEmail}{${PERSONAL_SCHOOL_EMAIL}}
        \newcommand{\personalHomeAddress}{${PERSONAL_HOME_ADDRESS}}
        \newcommand{\personalSchoolAddress}{${PERSONAL_SCHOOL_ADDRESS}}
        EOL
        
    - name: Upload Private PDFs
      uses: actions/upload-artifact@v3
      with:
        name: private-documents
        path: |
          resume.pdf
          cv.pdf 